<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ridgewood Jamboree - Merchant Sponsorship Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        theme: {
            extend: {
                borderRadius: {
                    lg: "var(--radius)",
                    md: "calc(var(--radius) - 2px)",
                    sm: "calc(var(--radius) - 4px)",
                },
                colors: {
                    background: "var(--background)",
                    foreground: "var(--foreground)",
                    card: {
                        DEFAULT: "var(--card)",
                        foreground: "var(--card-foreground)",
                    },
                    popover: {
                        DEFAULT: "var(--popover)",
                        foreground: "var(--popover-foreground)",
                    },
                    primary: {
                        DEFAULT: "var(--primary)",
                        foreground: "var(--primary-foreground)",
                    },
                    secondary: {
                        DEFAULT: "var(--secondary)",
                        foreground: "var(--secondary-foreground)",
                    },
                    muted: {
                        DEFAULT: "var(--muted)",
                        foreground: "var(--muted-foreground)",
                    },
                    accent: {
                        DEFAULT: "var(--accent)",
                        foreground: "var(--accent-foreground)",
                    },
                    destructive: {
                        DEFAULT: "var(--destructive)",
                        foreground: "var(--destructive-foreground)",
                    },
                    border: "var(--border)",
                    input: "var(--input)",
                    ring: "var(--ring)",
                }
            }
        }
    };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <style>
        /* Apple Design System Variables */
        :root {
            --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Inter", "Helvetica Neue", Helvetica, Arial, sans-serif;
            --background: hsl(210 40% 98%);
            --foreground: hsl(222.2 84% 4.9%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(222.2 84% 4.9%);
            --popover: hsl(0 0% 100%);
            --popover-foreground: hsl(222.2 84% 4.9%);
            --primary: hsl(212 97% 57%);
            --primary-foreground: hsl(210 40% 98%);
            --secondary: hsl(210 40% 96%);
            --secondary-foreground: hsl(222.2 47% 11%);
            --muted: hsl(210 40% 96%);
            --muted-foreground: hsl(215.4 16.3% 46.9%);
            --accent: hsl(210 40% 96%);
            --accent-foreground: hsl(222.2 47% 11%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(214.3 31.8% 91.4%);
            --input: hsl(214.3 31.8% 91.4%);
            --ring: hsl(212 97% 57%);
            --radius: 12px;
            --blur: 20px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .dark {
            --background: hsl(222.2 84% 4.9%);
            --foreground: hsl(210 40% 98%);
            --card: hsl(222.2 84% 4.9%);
            --card-foreground: hsl(210 40% 98%);
            --popover: hsl(222.2 84% 4.9%);
            --popover-foreground: hsl(210 40% 98%);
            --primary: hsl(210 80% 55%);
            --primary-foreground: hsl(222.2 47% 11%);
            --secondary: hsl(217.2 32.6% 17.5%);
            --secondary-foreground: hsl(210 40% 98%);
            --muted: hsl(217.2 32.6% 17.5%);
            --muted-foreground: hsl(215 20.2% 65.1%);
            --accent: hsl(217.2 32.6% 17.5%);
            --accent-foreground: hsl(210 40% 98%);
            --destructive: hsl(0 62.8% 55.6%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(217.2 32.6% 17.5%);
            --input: hsl(217.2 32.6% 17.5%);
            --ring: hsl(210 80% 55%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--background);
            color: var(--foreground);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Glassmorphism Navigation */
        .nav-glass {
            backdrop-filter: saturate(180%) blur(var(--blur));
            background: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .nav-glass {
            background: rgba(17, 17, 17, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Card Hover Effects */
        .card-hover {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Custom Buttons */
        .btn-apple {
            background: var(--primary);
            color: var(--primary-foreground);
            border: none;
            border-radius: var(--radius);
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-apple:hover {
            background: hsl(212 97% 50%);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--secondary-foreground);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 10px 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: var(--accent);
        }

        /* Modal Styles */
        .modal-backdrop {
            backdrop-filter: blur(4px);
            background: rgba(0, 0, 0, 0.4);
        }

        /* Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-available {
            background: rgba(34, 197, 94, 0.1);
            color: rgb(34, 197, 94);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .badge-assigned {
            background: rgba(168, 85, 247, 0.1);
            color: rgb(168, 85, 247);
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .badge-category {
            background: var(--muted);
            color: var(--muted-foreground);
            border: 1px solid var(--border);
        }

        /* Input Styles */
        .input-apple {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--background);
            color: var(--foreground);
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .input-apple:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Suggestions Dropdown */
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 50;
            max-height: 200px;
            overflow-y: auto;
        }

        .suggestion-item {
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: transparent;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            color: var(--foreground);
            border-bottom: 1px solid var(--border);
            transition: background 0.15s ease;
        }

        .suggestion-item:hover {
            background: var(--muted);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
            .mobile-menu {
                display: block;
            }
        }

        @media (min-width: 769px) {
            .desktop-nav {
                display: flex;
            }
            .mobile-menu {
                display: none;
            }
        }

        /* Performance Stats */
        .perf-stats {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 12px;
        }
    </style>

    <!-- Navigation -->
    <nav class="nav-glass sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-foreground">Ridgewood Jamboree</h1>
                </div>

                <!-- Desktop Navigation -->
                <div class="desktop-nav items-center space-x-8">
                    <button class="nav-link active" onclick="showMerchantSelection()">
                        <i data-lucide="building-2" class="w-4 h-4"></i>
                        <span>Merchant Selection</span>
                    </button>
                    <button class="nav-link" onclick="showMyAssignments()">
                        <i data-lucide="user-check" class="w-4 h-4"></i>
                        <span>My Assignments</span>
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i data-lucide="sun" class="w-4 h-4 sun-icon"></i>
                        <i data-lucide="moon" class="w-4 h-4 moon-icon hidden"></i>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu md:hidden" onclick="toggleMobileMenu()">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden pb-4">
                <div class="space-y-2">
                    <button class="mobile-nav-link" onclick="showMerchantSelection()">
                        <i data-lucide="building-2" class="w-4 h-4"></i>
                        <span>Merchant Selection</span>
                    </button>
                    <button class="mobile-nav-link" onclick="showMyAssignments()">
                        <i data-lucide="user-check" class="w-4 h-4"></i>
                        <span>My Assignments</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Merchant Selection Page -->
        <div id="merchantSelection" class="page-content">
            <!-- Header -->
            <header class="text-center mb-8">
                <div class="w-16 h-16 bg-primary rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="building-2" class="w-8 h-8 text-primary-foreground"></i>
                </div>
                <h1 class="text-4xl font-bold text-foreground mb-2">Merchant Sponsorship Portal</h1>
                <p class="text-lg text-muted-foreground max-w-2xl mx-auto">
                    Browse and assign merchants for ad sponsorships in the Ridgewood Jamboree program.
                </p>
                
                <!-- Performance Stats Toggle -->
                <button class="btn-secondary mt-4 text-xs" onclick="togglePerformanceStats()">
                    <span id="perfToggleText">Show Performance Stats</span>
                </button>
            </header>

            <!-- Performance Stats -->
            <div id="performanceStats" class="hidden bg-card border border-border rounded-lg p-4 mb-6">
                <h4 class="font-semibold mb-3">Performance Report</h4>
                <div class="perf-stats grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-xs">
                    <div>Load Time: <span class="font-mono">245ms</span></div>
                    <div>Search Time: <span class="font-mono">12ms</span></div>
                    <div>Render Time: <span class="font-mono">18ms</span></div>
                    <div>Device: <span class="font-mono">Desktop</span></div>
                    <div>Memory: <span class="font-mono">23MB</span></div>
                    <div>Merchants: <span class="font-mono">156/42/30</span></div>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="bg-card border border-border rounded-lg p-6 mb-6">
                <!-- Search Input -->
                <div class="relative mb-6">
                    <i data-lucide="search" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                    <input type="text" class="input-apple pl-12" placeholder="Search merchants..." id="searchInput" oninput="filterMerchants()">
                </div>
                
                <!-- Filter Controls -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-muted-foreground mb-2">Assignment Status</label>
                        <select class="input-apple" id="assignmentFilter" onchange="filterMerchants()">
                            <option value="all">All Merchants</option>
                            <option value="unassigned">Unassigned Only</option>
                            <option value="assigned">Assigned Only</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-muted-foreground mb-2">Category</label>
                        <select class="input-apple" id="categoryFilter" onchange="filterMerchants()">
                            <option value="all">All Categories</option>
                            <option value="restaurant">Restaurant</option>
                            <option value="retail">Retail</option>
                            <option value="services">Services</option>
                            <option value="health">Health & Beauty</option>
                            <option value="automotive">Automotive</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-muted-foreground mb-2">Sub-Category</label>
                        <select class="input-apple" id="subCategoryFilter" onchange="filterMerchants()">
                            <option value="all">All Sub-Categories</option>
                            <option value="pizza">Pizza</option>
                            <option value="coffee">Coffee</option>
                            <option value="clothing">Clothing</option>
                            <option value="salon">Salon</option>
                            <option value="car-repair">Car Repair</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results Counter -->
            <div class="text-center mb-6">
                <p class="text-sm text-muted-foreground">
                    Showing <strong class="text-foreground">30</strong> of <strong class="text-foreground">42</strong> merchants
                    (156 total)
                </p>
            </div>

            <!-- Merchant Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="merchantGrid">
                <!-- Merchant Cards will be dynamically generated -->
            </div>

            <!-- Load More Button -->
            <div class="text-center">
                <button class="btn-apple" onclick="loadMoreMerchants()">
                    <i data-lucide="loader" class="w-4 h-4"></i>
                    Load More Merchants
                </button>
            </div>
        </div>

        <!-- My Assignments Page -->
        <div id="myAssignments" class="page-content hidden">
            <!-- Header -->
            <header class="text-center mb-8">
                <div class="w-16 h-16 bg-primary rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="user-check" class="w-8 h-8 text-primary-foreground"></i>
                </div>
                <h1 class="text-4xl font-bold text-foreground mb-2">My Assigned Merchants</h1>
                <p class="text-lg text-muted-foreground max-w-2xl mx-auto">
                    View all merchants assigned to you for ad sponsorship outreach.
                </p>
            </header>

            <!-- Search Form -->
            <div class="bg-card border border-border rounded-lg p-6 mb-6 max-w-2xl mx-auto">
                <label class="block text-sm font-medium text-muted-foreground mb-2">Enter Your Full Name</label>
                <div class="flex gap-4 relative">
                    <div class="flex-1 relative">
                        <input type="text" class="input-apple" placeholder="Type your full name..." 
                               id="volunteerNameInput" oninput="showVolunteerSuggestions()" onfocus="showVolunteerSuggestions()"
                               onblur="hideVolunteerSuggestions()" onkeydown="handleVolunteerKeydown(event)">
                        
                        <!-- Suggestions Dropdown -->
                        <div id="volunteerSuggestions" class="suggestions hidden">
                            <!-- Suggestions will be populated dynamically -->
                        </div>
                    </div>
                    <button class="btn-apple" onclick="searchAssignments()">
                        <i data-lucide="search" class="w-4 h-4"></i>
                        Find
                    </button>
                </div>
                <p class="text-xs text-muted-foreground mt-2">
                    * Enter your name exactly as it was used during assignment. Maximum 3 assignments per volunteer.
                </p>
            </div>

            <!-- Assignment Results -->
            <div id="assignmentResults" class="hidden">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-foreground mb-2">Your Assignments (3/3)</h2>
                    <p class="text-muted-foreground">
                        Assigned to: <span class="font-semibold text-foreground">Sarah Johnson</span>
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Assignment cards will be populated dynamically -->
                </div>
            </div>

            <!-- No Assignments Found -->
            <div id="noAssignments" class="hidden bg-destructive/10 border border-destructive/20 rounded-lg p-6 text-center max-w-2xl mx-auto">
                <h4 class="text-destructive font-semibold mb-2">No Assignments Found</h4>
                <p class="text-muted-foreground">No assignments found for this volunteer name. Please check the spelling and try again.</p>
            </div>

            <!-- Initial State -->
            <div id="initialState" class="text-center py-16">
                <i data-lucide="user-check" class="w-12 h-12 text-muted-foreground/50 mx-auto mb-4"></i>
                <p class="text-muted-foreground">Enter your name above to view your assigned merchants.</p>
            </div>
        </div>
    </main>

    <!-- Assignment Modal -->
    <div id="assignmentModal" class="fixed inset-0 modal-backdrop items-center justify-center z-50 hidden">
        <div class="bg-card border border-border rounded-lg shadow-lg max-w-md w-full mx-4 slide-up">
            <div class="p-6 relative">
                <!-- Close Button -->
                <button class="absolute top-4 right-4 w-8 h-8 bg-secondary rounded-full flex items-center justify-center hover:bg-accent transition-colors" onclick="closeAssignmentModal()">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>

                <!-- Header -->
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
                        <i data-lucide="user-check" class="w-5 h-5 text-primary-foreground"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-foreground">Assign Merchant</h2>
                        <p class="text-sm text-muted-foreground">Select a volunteer for this merchant</p>
                    </div>
                </div>

                <!-- Merchant Info -->
                <div class="bg-muted rounded-lg p-4 mb-6">
                    <h3 class="font-semibold text-foreground mb-2" id="modalMerchantName">Tony's Pizza Palace</h3>
                    <div class="flex gap-2 mb-2">
                        <span class="badge badge-category">Restaurant</span>
                        <span class="badge badge-category">Pizza</span>
                    </div>
                    <p class="text-sm text-muted-foreground" id="modalMerchantAddress">123 Main Street, Ridgewood, NJ 07450</p>
                </div>

                <!-- Volunteer Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-muted-foreground mb-2">Select Volunteer</label>
                    <select class="input-apple" id="volunteerSelect">
                        <option value="" disabled selected>Choose a volunteer</option>
                        <option value="Sarah Johnson">Sarah Johnson</option>
                        <option value="Mike Chen">Mike Chen</option>
                        <option value="Emily Rodriguez">Emily Rodriguez</option>
                        <option value="David Kim">David Kim</option>
                        <option value="Lisa Thompson">Lisa Thompson</option>
                    </select>
                    <p class="text-xs text-muted-foreground mt-1">
                        Note: Each volunteer can only have up to 3 merchants assigned.
                    </p>
                </div>

                <!-- Actions -->
                <div class="flex gap-3 pt-4 border-t border-border">
                    <button class="btn-secondary flex-1" onclick="closeAssignmentModal()">Cancel</button>
                    <button class="btn-apple flex-1" onclick="assignMerchant()">
                        <i data-lucide="check" class="w-4 h-4"></i>
                        Assign Merchant
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Sample data
        const merchants = [
            {
                id: 1,
                business_name: "Tony's Pizza Palace",
                category: "restaurant",
                sub_category: "pizza",
                address: "123 Main Street, Ridgewood, NJ 07450",
                contact_person: "Tony Rossi",
                phone: "(201) 555-0123",
                email: "tony@tonypizza.com",
                assigned_to: null,
                icon: "ðŸ•"
            },
            {
                id: 2,
                business_name: "Bella's Beauty Salon",
                category: "health",
                sub_category: "salon",
                address: "456 Oak Avenue, Ridgewood, NJ 07450",
                contact_person: "Isabella Martinez",
                phone: "(201) 555-0456",
                email: "bella@bellasalon.com",
                assigned_to: "Sarah Johnson",
                icon: "âœ‚ï¸"
            },
            {
                id: 3,
                business_name: "Ridgewood Coffee Co.",
                category: "restaurant",
                sub_category: "coffee",
                address: "789 Elm Street, Ridgewood, NJ 07450",
                contact_person: "Jake Morrison",
                phone: "(201) 555-0789",
                email: "info@ridgewoodcoffee.com",
                assigned_to: null,
                icon: "â˜•"
            },
            {
                id: 4,
                business_name: "Elite Auto Repair",
                category: "automotive",
                sub_category: "car-repair",
                address: "321 Pine Road, Ridgewood, NJ 07450",
                contact_person: "Marcus Williams",
                phone: "(201) 555-0321",
                email: "marcus@eliteauto.com",
                assigned_to: "Mike Chen",
                icon: "ðŸš—"
            },
            {
                id: 5,
                business_name: "Fashion Forward Boutique",
                category: "retail",
                sub_category: "clothing",
                address: "654 Cedar Lane, Ridgewood, NJ 07450",
                contact_person: "Amanda Foster",
                phone: "(201) 555-0654",
                email: "amanda@fashionforward.com",
                assigned_to: null,
                icon: "ðŸ‘”"
            },
            {
                id: 6,
                business_name: "Green Garden Market",
                category: "retail",
                sub_category: "grocery",
                address: "987 Maple Drive, Ridgewood, NJ 07450",
                contact_person: "Tom Anderson",
                phone: "(201) 555-0987",
                email: "tom@greengardenmarket.com",
                assigned_to: "Sarah Johnson",
                icon: "ðŸ›’"
            }
        ];

        const volunteers = [
            "Sarah Johnson",
            "Mike Chen", 
            "Emily Rodriguez",
            "David Kim",
            "Lisa Thompson",
            "Alex Carter",
            "Jessica Wong",
            "Ryan Murphy"
        ];

        let filteredMerchants = [...merchants];
        let currentMerchant = null;

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            
            // Update icons
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            
            if (isDark) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                localStorage.setItem('theme', 'dark');
            } else {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme from localStorage
        function initTheme() {
            const theme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (theme === 'dark' || (!theme && prefersDark)) {
                document.documentElement.classList.add('dark');
                document.querySelector('.sun-icon').classList.add('hidden');
                document.querySelector('.moon-icon').classList.remove('hidden');
            }
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        }

        // Page navigation
        function showMerchantSelection() {
            document.getElementById('merchantSelection').classList.remove('hidden');
            document.getElementById('myAssignments').classList.add('hidden');
            
            // Update active states
            document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector('[onclick="showMerchantSelection()"]').classList.add('active');
            
            // Hide mobile menu
            document.getElementById('mobileMenu').classList.add('hidden');
        }

        function showMyAssignments() {
            document.getElementById('merchantSelection').classList.add('hidden');
            document.getElementById('myAssignments').classList.remove('hidden');
            
            // Update active states
            document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector('[onclick="showMyAssignments()"]').classList.add('active');
            
            // Hide mobile menu
            document.getElementById('mobileMenu').classList.add('hidden');
        }

        // Performance stats toggle
        function togglePerformanceStats() {
            const stats = document.getElementById('performanceStats');
            const toggleText = document.getElementById('perfToggleText');
            
            if (stats.classList.contains('hidden')) {
                stats.classList.remove('hidden');
                toggleText.textContent = 'Hide Performance Stats';
            } else {
                stats.classList.add('hidden');
                toggleText.textContent = 'Show Performance Stats';
            }
        }

        // Filter merchants
        function filterMerchants() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const assignmentFilter = document.getElementById('assignmentFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const subCategoryFilter = document.getElementById('subCategoryFilter').value;

            filteredMerchants = merchants.filter(merchant => {
                // Search filter
                const matchesSearch = !searchText || 
                    merchant.business_name.toLowerCase().includes(searchText) ||
                    merchant.category.toLowerCase().includes(searchText) ||
                    merchant.sub_category.toLowerCase().includes(searchText) ||
                    merchant.address.toLowerCase().includes(searchText);

                // Assignment filter
                const matchesAssignment = assignmentFilter === 'all' ||
                    (assignmentFilter === 'assigned' && merchant.assigned_to) ||
                    (assignmentFilter === 'unassigned' && !merchant.assigned_to);

                // Category filter
                const matchesCategory = categoryFilter === 'all' || merchant.category === categoryFilter;

                // Sub-category filter
                const matchesSubCategory = subCategoryFilter === 'all' || merchant.sub_category === subCategoryFilter;

                return matchesSearch && matchesAssignment && matchesCategory && matchesSubCategory;
            });

            renderMerchants();
        }

        // Render merchant cards
        function renderMerchants() {
            const grid = document.getElementById('merchantGrid');
            grid.innerHTML = '';

            filteredMerchants.slice(0, 30).forEach((merchant, index) => {
                const card = createMerchantCard(merchant, index);
                grid.appendChild(card);
            });

            // Re-initialize Lucide icons for new content
            lucide.createIcons();
        }

        // Create merchant card
        function createMerchantCard(merchant, index) {
            const div = document.createElement('div');
            div.className = 'bg-card border border-border rounded-lg p-6 card-hover fade-in';
            div.style.animationDelay = `${index * 50}ms`;
            
            div.innerHTML = `
                <div class="flex items-start justify-between gap-3 mb-4">
                    <div class="flex items-center gap-3 flex-1 min-w-0">
                        <div class="w-12 h-12 bg-muted rounded-lg flex items-center justify-center text-xl flex-shrink-0">
                            ${merchant.icon}
                        </div>
                        <div class="min-w-0 flex-1">
                            <h3 class="font-semibold text-foreground text-lg mb-1 truncate">${merchant.business_name}</h3>
                            <div class="flex gap-1 flex-wrap">
                                <span class="badge badge-category">${merchant.category}</span>
                                <span class="badge badge-category">${merchant.sub_category}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex-shrink-0">
                        ${merchant.assigned_to ? 
                            '<span class="badge badge-assigned"><i data-lucide="check-circle" class="w-3 h-3"></i>Assigned</span>' :
                            '<span class="badge badge-available"><i data-lucide="user" class="w-3 h-3"></i>Available</span>'
                        }
                    </div>
                </div>

                <div class="space-y-3 mb-4">
                    <div class="flex items-start gap-2">
                        <i data-lucide="map-pin" class="w-4 h-4 text-muted-foreground mt-0.5 flex-shrink-0"></i>
                        <span class="text-sm text-muted-foreground">${merchant.address}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="phone" class="w-4 h-4 text-muted-foreground flex-shrink-0"></i>
                        <a href="tel:${merchant.phone}" class="text-sm text-primary hover:underline">${merchant.phone}</a>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="mail" class="w-4 h-4 text-muted-foreground flex-shrink-0"></i>
                        <a href="mailto:${merchant.email}" class="text-sm text-primary hover:underline truncate">${merchant.email}</a>
                    </div>
                </div>

                ${merchant.assigned_to ? 
                    `<div class="pt-4 border-t border-border">
                        <p class="text-sm">
                            <span class="text-muted-foreground">Assigned to: </span>
                            <span class="font-semibold text-foreground">${merchant.assigned_to}</span>
                        </p>
                    </div>` :
                    `<div class="pt-4">
                        <button class="btn-apple w-full" onclick="openAssignmentModal(${merchant.id})">
                            <i data-lucide="user-plus" class="w-4 h-4"></i>
                            Select This Merchant
                        </button>
                    </div>`
                }
            `;

            return div;
        }

        // Assignment modal functions
        function openAssignmentModal(merchantId) {
            currentMerchant = merchants.find(m => m.id === merchantId);
            if (currentMerchant) {
                document.getElementById('modalMerchantName').textContent = currentMerchant.business_name;
                document.getElementById('modalMerchantAddress').textContent = currentMerchant.address;
                document.getElementById('assignmentModal').classList.remove('hidden');
                document.getElementById('assignmentModal').classList.add('flex');
            }
        }

        function closeAssignmentModal() {
            document.getElementById('assignmentModal').classList.add('hidden');
            document.getElementById('assignmentModal').classList.remove('flex');
            document.getElementById('volunteerSelect').value = '';
            currentMerchant = null;
        }

        function assignMerchant() {
            const volunteerName = document.getElementById('volunteerSelect').value;
            if (currentMerchant && volunteerName) {
                // Update merchant assignment
                currentMerchant.assigned_to = volunteerName;
                
                // Re-render merchants
                filterMerchants();
                
                // Close modal
                closeAssignmentModal();
                
                // Show success message (simple alert for demo)
                alert(`Successfully assigned ${currentMerchant.business_name} to ${volunteerName}`);
            }
        }

        // Volunteer suggestions for My Assignments
        function showVolunteerSuggestions() {
            const input = document.getElementById('volunteerNameInput');
            const suggestions = document.getElementById('volunteerSuggestions');
            const searchTerm = input.value.toLowerCase();
            
            if (searchTerm.length > 0) {
                const filtered = volunteers.filter(name => 
                    name.toLowerCase().includes(searchTerm)
                ).slice(0, 5);
                
                if (filtered.length > 0) {
                    suggestions.innerHTML = filtered.map(name => 
                        `<button class="suggestion-item" onclick="selectVolunteer('${name}')">${name}</button>`
                    ).join('');
                    suggestions.classList.remove('hidden');
                } else {
                    suggestions.classList.add('hidden');
                }
            } else {
                suggestions.classList.add('hidden');
            }
        }

        function hideVolunteerSuggestions() {
            setTimeout(() => {
                document.getElementById('volunteerSuggestions').classList.add('hidden');
            }, 200);
        }

        function selectVolunteer(name) {
            document.getElementById('volunteerNameInput').value = name;
            document.getElementById('volunteerSuggestions').classList.add('hidden');
            searchAssignments();
        }

        function handleVolunteerKeydown(event) {
            if (event.key === 'Enter') {
                searchAssignments();
            }
        }

        // Search assignments
        function searchAssignments() {
            const volunteerName = document.getElementById('volunteerNameInput').value.trim();
            
            if (!volunteerName) return;
            
            const userAssignments = merchants.filter(m => m.assigned_to === volunteerName);
            
            // Hide all result sections
            document.getElementById('assignmentResults').classList.add('hidden');
            document.getElementById('noAssignments').classList.add('hidden');
            document.getElementById('initialState').classList.add('hidden');
            
            if (userAssignments.length > 0) {
                // Show assignment results
                renderAssignments(userAssignments, volunteerName);
                document.getElementById('assignmentResults').classList.remove('hidden');
            } else {
                // Show no assignments message
                document.getElementById('noAssignments').classList.remove('hidden');
            }
        }

        // Render assignment cards
        function renderAssignments(assignments, volunteerName) {
            const container = document.querySelector('#assignmentResults .grid');
            container.innerHTML = '';
            
            // Update header
            document.querySelector('#assignmentResults h2').textContent = `Your Assignments (${assignments.length}/3)`;
            document.querySelector('#assignmentResults span.font-semibold').textContent = volunteerName;
            
            assignments.forEach((merchant, index) => {
                const card = createAssignmentCard(merchant, index);
                container.appendChild(card);
            });
            
            // Re-initialize Lucide icons
            lucide.createIcons();
        }

        // Create assignment card
        function createAssignmentCard(merchant, index) {
            const div = document.createElement('div');
            div.className = 'bg-card border border-border rounded-lg p-6 fade-in';
            div.style.animationDelay = `${index * 100}ms`;
            
            div.innerHTML = `
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-muted rounded-lg flex items-center justify-center text-xl">
                        ${merchant.icon}
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-foreground mb-1">${merchant.business_name}</h3>
                        <div class="flex gap-1 flex-wrap">
                            <span class="badge badge-category">${merchant.category}</span>
                            <span class="badge badge-category">${merchant.sub_category}</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="flex items-start gap-2">
                        <i data-lucide="map-pin" class="w-4 h-4 text-muted-foreground mt-0.5 flex-shrink-0"></i>
                        <span class="text-sm text-muted-foreground">${merchant.address}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="phone" class="w-4 h-4 text-muted-foreground flex-shrink-0"></i>
                        <a href="tel:${merchant.phone}" class="text-sm text-primary hover:underline">${merchant.phone}</a>
                    </div>
                    <div class="flex items-center gap-2">
                        <i data-lucide="mail" class="w-4 h-4 text-muted-foreground flex-shrink-0"></i>
                        <a href="mailto:${merchant.email}" class="text-sm text-primary hover:underline truncate">${merchant.email}</a>
                    </div>
                </div>
            `;

            return div;
        }

        // Load more merchants (demo function)
        function loadMoreMerchants() {
            // TODO: Implement pagination logic
            alert('Load more functionality would be implemented here');
        }

        // Initialize the application
        function init() {
            initTheme();
            renderMerchants();
            
            // Set up navigation styles
            const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
            navLinks.forEach(link => {
                link.className += ' inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent transition-colors';
            });
            
            // Mark first nav item as active
            document.querySelector('[onclick="showMerchantSelection()"]').classList.add('active');
            
            // Add active state styles
            const style = document.createElement('style');
            style.textContent = `
                .nav-link.active, .mobile-nav-link.active {
                    background: var(--primary) !important;
                    color: var(--primary-foreground) !important;
                }
                .nav-link.active:hover, .mobile-nav-link.active:hover {
                    background: hsl(212 97% 50%) !important;
                }
                .mobile-nav-link {
                    display: flex;
                    width: 100%;
                    text-align: left;
                    background: none;
                    border: none;
                    cursor: pointer;
                }
                .theme-toggle {
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    padding: 8px 12px;
                    border-radius: var(--radius);
                    background: var(--secondary);
                    border: 1px solid var(--border);
                    color: var(--foreground);
                    cursor: pointer;
                    transition: all 0.2s ease;
                }
                .theme-toggle:hover {
                    background: var(--accent);
                }
            `;
            document.head.appendChild(style);
        }

        // Run initialization when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);

        // Close modal when clicking outside
        document.getElementById('assignmentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAssignmentModal();
            }
        });
    </script>
</body>
</html>